!function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={exports:{},id:r,loaded:!1};return e[r].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){e?i():A.writeLog("APP_002","invalid server settings",P)}function i(){S.navClient=new s({username:P.navCoin.user,password:P.navCoin.pass,port:P.navCoin.port,host:P.navCoin.host}),S.subClient=new s({username:P.subChain.user,password:P.subChain.pass,port:P.subChain.port,host:P.subChain.host}),P.ssl?l.exists(P.ssl.key,function(e){l.exists(P.ssl.crt,function(t){if(!e||!t)return void A.writeLog("APP_003","unable to find user defined ssl certificate",P.ssl);var n={key:l.readFileSync(P.ssl.key),cert:l.readFileSync(P.ssl.crt),requestCert:!1,rejectUnauthorized:!1};w.use(o()),w.use(d.json()),w.use(d.urlencoded({extended:!0})),u.createServer(n,w).listen(P.local.port,function(){L()})})}):c.createCertificate({days:1,selfSigned:!0},function(e,t){var n={key:t.serviceKey,cert:t.certificate,requestCert:!1,rejectUnauthorized:!1};w.use(o()),w.use(d.json()),w.use(d.urlencoded({extended:!0})),u.createServer(n,w).listen(P.local.port,function(){L()})})}var s=n(1),a=n(2),o=n(3),u=n(4),c=n(5),d=n(6),l=n(7),g=n(8),p=n(9),m=n(10),v=n(34),f=n(39),h=n(18),y=n(20),b=n(22),T=n(12),A=n(14),C=n(16),k=g.get("GLOBAL"),P=!1;"INCOMING"===k.serverType&&(P=g.get("INCOMING")),"OUTGOING"===k.serverType&&(P=g.get("OUTGOING")),A.writeLog("SYS_001","Server Starting",{memes:["harambe","rustled jimmies"]},!0);var w=a(),S={};P?f.validateSettings({settings:P},r):A.writeLog("APP_001","invalid global server type",k.serverType);var L=function(){"INCOMING"===k.serverType?(m.init(),_()):"OUTGOING"===k.serverType&&(v.init(),_())},_=function(){w.get("/",function(e,t){p("dist/navtech.js",function(e,n){return e?void t.send(JSON.stringify({status:200,type:"FAILURE",message:"error generating md5 hash",serverType:k.serverType,error:e})):void t.send(JSON.stringify({status:200,type:"SUCCESS",message:"server is running!",serverType:k.serverType,anonhash:n}))})}),w.post("/api/test-decryption",function(e,t){return S.runtime={},S.runtime.req=e,S.runtime.res=t,e.body&&e.body.encrypted_data?void y.decryptData({encryptedData:S.runtime.req.body.encrypted_data},S.checkDecrypted):(A.writeLog("APP_004","failed to receive params",{body:e.body}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_004",message:"failed to receive params"})))}),S.checkDecrypted=function(e,t){return e&&t&&t.decrypted?void S.runtime.res.send(JSON.stringify({status:200,type:"SUCCESS",message:"decryption test successful"})):(A.writeLog("APP_005","unable to derypt the data",{success:e,data:t,body:S.runtime.req.body}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_005",message:"ERROR: unable to decrypt the data"})))},w.post("/api/get-addresses",function(e,t){return S.runtime={},S.runtime.req=e,S.runtime.res=t,S.runtime.req.body&&S.runtime.req.body.num_addresses&&S.runtime.req.body.type&&S.runtime.req.body.account?(S.runtime.accountToUse=C.account[S.runtime.req.body.account],S.runtime.accountToUse||S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_006A",message:"ERROR: invalid account",body:S.runtime.req.body})),"OUTGOING"===k.serverType?void S.checkIpAddress({allowedIps:P.remote},S.getAddresses):void S.getAddresses()):(A.writeLog("APP_006","failed to receive params",{body:e.body}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_006",message:"ERROR: invalid params",body:S.runtime.req.body})))}),S.getAddresses=function(){S.runtime.numAddresses=parseInt(S.runtime.req.body.num_addresses,10),"SUBCHAIN"===S.runtime.req.body.type?S.runtime.clientToUse=S.subClient:S.runtime.clientToUse=S.navClient,b.getRandomAccountAddresses({client:S.runtime.clientToUse,accountName:S.runtime.accountToUse,numAddresses:S.runtime.numAddresses},S.returnAddresses)},S.returnAddresses=function(e,t){return e&&t&&t.pickedAddresses?void S.runtime.res.send(JSON.stringify({status:200,type:"SUCCESS",data:{addresses:t.pickedAddresses}})):(A.writeLog("APP_008","failed to pick random addresses",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_008",message:"failed to pick random addresses"})))},w.get("/api/get-nav-balance",function(e,t){S.runtime={},S.runtime.req=e,S.runtime.res=t,S.navClient.getBalance().then(function(e){S.runtime.res.send(JSON.stringify({status:200,type:"SUCCESS",data:{nav_balance:e}}))}).catch(function(e){A.writeLog("APP_009","failed to get the NAV balance",{error:e}),S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_009",message:"failed to get the NAV balance"}))})}),S.checkIpAddress=function(e,t){for(var n=S.runtime.req.connection.remoteAddress||S.runtime.req.socket.remoteAddress,r=!1,i=0;i<e.allowedIps.length;i++)n!==e.allowedIps[i].ipAddress&&n!=="::ffff:"+e.allowedIps[i].ipAddress||(r=!0);r?t():(A.writeLog("APP_025","unauthorized access attempt",{remoteIpAddress:n,remote:e.allowedIps}),S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_025",message:"unauthorized access attempt"})))},w.post("/api/check-node",function(e,t){return S.runtime={},S.runtime.req=e,S.runtime.res=t,S.runtime.req.body&&S.runtime.req.body.num_addresses?"INCOMING"===k.serverType&&m.paused||"OUTGOING"===k.serverType&&v.paused?(A.writeLog("APP_026A","this server is paused for manual recovery",{body:e.body}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_026A",message:"server is not accepting transactions"}))):(S.runtime.numAddresses=parseInt(S.runtime.req.body.num_addresses,10),"INCOMING"===k.serverType?k.maintenance?void S.checkIpAddress({allowedIps:k.allowedIps},S.checkNavBlocks):void S.checkNavBlocks():void S.checkIpAddress({allowedIps:P.remote},S.checkNavBlocks)):(A.writeLog("APP_026","failed to receive params",{body:e.body}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_026",message:"failed to receive params"})))}),S.checkNavBlocks=function(){h.checkBlockHeight({client:S.navClient,blockThreshold:C.blockThreshold.checking},S.navBlocksChecked)},S.navBlocksChecked=function(e,t){return e&&t?(S.runtime.navBalance=t.balance,void h.checkBlockHeight({client:S.subClient,blockThreshold:C.blockThreshold.checking},S.subBlocksChecked)):(A.writeLog("APP_027","navClient block check failed",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_027",message:"navClient block check failed"})))},S.subBlocksChecked=function(e,t){return e&&t?(S.runtime.subBalance=t.balance,void h.unlockWallet({settings:P,client:S.navClient,type:"navCoin"},S.unlockSubchain)):(A.writeLog("APP_028","subClient block check failed",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_028",message:"subClient block check failed"})))},S.unlockSubchain=function(e,t){return e?void h.unlockWallet({settings:P,client:S.subClient,type:"subChain"},S.getUnspent):(A.writeLog("APP_029","navClient failed to unlock",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_029",message:"navClient failed to unlock"})))},S.getUnspent=function(e,t){return e?"OUTGOING"===k.serverType?void T.getEncryptionKeys({},S.testKeyPair):void S.navClient.listUnspent().then(function(e){return e.length<1?void T.getEncryptionKeys({},S.testKeyPair):void h.filterUnspent({unspent:e,client:S.navClient,accountName:C.account[k.serverType]},S.processFiltered)}).catch(function(e){A.writeLog("APP_030A","failed to get unspent from the navClient",{error:e}),S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_030A",message:"failed to get unspent from the navClient"}))}):(A.writeLog("APP_030","subClient failed to unlock",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_030",message:"subClient failed to unlock"})))},S.processFiltered=function(e,t){if(!e)return A.writeLog("APP_030C","failed to filter the unspent",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_030C",message:"failed to filter the unspent"}));var n=0;if(t.currentPending&&t.currentPending.length>0){var r=!0,i=!1,s=void 0;try{for(var a,o=t.currentPending[Symbol.iterator]();!(r=(a=o.next()).done);r=!0){var u=a.value;u.confirmations>n&&(n=u.confirmations)}}catch(e){i=!0,s=e}finally{try{!r&&o.return&&o.return()}finally{if(i)throw s}}if(n>C.maxQueue)return A.writeLog("APP_030B","the queue is too long",{highestConf:n},!0),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_030B",message:"the queue is too long"}))}T.getEncryptionKeys({},S.testKeyPair)},S.testKeyPair=function(e,t){return e&&t&&t.privKeyFile&&t.pubKeyFile?void T.testKeyPair({pubKeyFile:t.pubKeyFile,privKeyFile:t.privKeyFile},S.testedKeypair):(A.writeLog("APP_031","failed to get the current keys",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_031",message:"failed to get the current keys"})))},S.testedKeypair=function(e,t){return e&&t&&t.publicKey?(S.runtime.publicKey=t.publicKey,void b.getRandomAccountAddresses({client:S.navClient,accountName:C.account[k.serverType],numAddresses:S.runtime.numAddresses},S.hasRandomAddresses)):(A.writeLog("APP_032","failed to encrypt with selected keypair",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_032",message:"failed to encrypt with selected keypair"})))},S.hasRandomAddresses=function(e,t){return e&&t&&t.pickedAddresses?(S.runtime.navAddresses=t.pickedAddresses,void S.getHash()):(A.writeLog("APP_033","failed to retrieve nav addresses",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_033",message:"failed to retrieve nav addresses"})))},S.hasRandomSubAddresses=function(e,t){return e&&t&&t.pickedAddresses?(S.runtime.subAddresses=t.pickedAddresses,void S.getHash()):(A.writeLog("APP_034","failed to retrieve subchain addresses",{success:e,data:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAIL",code:"APP_034",message:"failed to retrieve subchain addresses"})))},S.getHash=function(){p("dist/navtech.js",function(e,t){return e?(A.writeLog("APP_035A","error generating md5 hash",{err:e,hash:t}),void S.runtime.res.send(JSON.stringify({status:200,type:"FAILURE",message:"error generating md5 hash",serverType:k.serverType,error:e}))):void S.returnCheckedNode(t)})},S.returnCheckedNode=function(e){var t=P.local.host?P.local.host:P.local.ipAddress,n={nav_balance:S.runtime.navBalance,sub_balance:S.runtime.subBalance,public_key:S.runtime.publicKey,server_type:k.serverType,min_amount:P.minAmount,max_amount:P.maxAmount,transaction_fee:P.anonFeePercent,server:t,server_port:P.local.port?P.local.port:443,md5:e};n.nav_addresses=S.runtime.navAddresses,S.runtime.res.send(JSON.stringify({status:200,type:"SUCCESS",data:n}))},w.get("/api/status",function(e,t){if(S.runtime={},S.runtime.req=e,S.runtime.res=t,"INCOMING"===k.serverType){var n=new Date,r=n-m.runtime.cycleStart,i=P.scriptInterval-r;S.runtime.res.send(JSON.stringify({status:200,type:"SUCCESS",data:{processing:m.processing,paused:m.paused,nextCycleStart:Math.round(i/1e3)+" seconds"}}))}else if("OUTGOING"===k.serverType){var s=new Date,a=s-v.runtime.cycleStart,o=P.scriptInterval-a;S.runtime.res.send(JSON.stringify({status:200,type:"SUCCESS",data:{processing:v.processing,paused:v.paused,nextCycleStart:Math.round(o/1e3)+" seconds"}}))}})}},function(e,t){e.exports=require("bitcoin-core")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("https")},function(e,t){e.exports=require("pem")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("config")},function(e,t){e.exports=require("md5-file")},function(e,t,n){"use strict";var r=n(1),i=n(8),s=n(11),a=n(12),o=n(14),u=n(17),c=n(19),d=n(23),l=n(25),g=n(27),p=n(30),m=n(31),v=n(33),f=i.get("INCOMING"),h={processing:!1,paused:!1,runtime:{}};h.init=function(){h.navClient=new r({username:f.navCoin.user,password:f.navCoin.pass,port:f.navCoin.port,host:f.navCoin.host}),h.subClient=new r({username:f.subChain.user,password:f.subChain.pass,port:f.subChain.port,host:f.subChain.host}),o.writeLog("INC_000","server starting"),a.findKeysToRemove({type:"private"},h.startProcessing),h.cron=setInterval(function(){h.paused===!1?a.findKeysToRemove({type:"private"},h.startProcessing):(clearInterval(h.cron),o.writeLog("INC_001","processing paused",{paused:h.paused}))},f.scriptInterval)},h.startProcessing=function(){return h.processing?void o.writeLog("INC_002","server still processing",{processing:h.processing}):(h.processing=!0,h.runtime={},h.runtime.cycleStart=new Date,void u.run({navClient:h.navClient,subClient:h.subClient,settings:f},h.preFlightComplete))},h.preFlightComplete=function(e,t){return e?(h.runtime.navBalance=t.navBalance,h.runtime.subBalance=t.subBalance,void c.run({navClient:h.navClient},h.holdingProcessed)):(o.writeLog("INC_003","preflight checks failed",{success:e,data:t},!0),void(h.processing=!1))},h.holdingProcessed=function(e,t){return e?void d.run({settings:f,navClient:h.navClient},h.outgoingSelected):(o.writeLog("INC_004","failed to process the holding account",{success:e,data:t},!0),h.processing=!1,void(h.paused=!0))},h.outgoingSelected=function(e,t){return e?t.returnAllToSenders?(t.pause&&(h.paused=!0),void l.run({navClient:h.navClient},h.allPendingReturned)):(h.runtime.chosenOutgoing=t.chosenOutgoing,h.runtime.outgoingNavBalance=t.outgoingNavBalance,h.runtime.holdingEncrypted=t.holdingEncrypted,h.runtime.outgoingPubKey=t.outgoingPubKey,void g.run({navClient:h.navClient,outgoingNavBalance:t.outgoingNavBalance,subBalance:h.runtime.subBalance,settings:f},h.currentBatchPrepared)):(o.writeLog("INC_005","failed to find outgoing server",{success:e,data:t},!0),void(h.processing=!1))},h.allPendingReturned=function(e,t){return e?(o.writeLog("INC_007","returned all pending to sender",{success:e,data:t},!0),void(h.processing=!1)):(o.writeLog("INC_006","failed to return all pending to sender",{success:e,data:t},!0),h.processing=!1,void(h.paused=!0))},h.currentBatchPrepared=function(e,t){return e&&t&&(t.currentBatch&&t.currentFlattened&&t.numFlattened||t.pendingToReturn)?(h.runtime.currentBatch=t.currentBatch,h.runtime.currentFlattened=t.currentFlattened,h.runtime.numFlattened=t.numFlattened,h.runtime.pendingToReturn=t.pendingToReturn,h.runtime.pendingToReturn&&h.runtime.pendingToReturn.length>0?(o.writeLog("INC_011","failed to process some transactions",{success:e,data:t},!0),void l.fromList({navClient:h.navClient,transactionsToReturn:h.runtime.pendingToReturn},h.pendingFailedReturned)):h.runtime.currentBatch&&0!==s.size(h.runtime.currentBatch)?void p.run({subClient:h.subClient,chosenOutgoing:h.runtime.chosenOutgoing,numAddresses:h.runtime.numFlattened},h.retrievedSubchainAddresses):(o.writeLog("INC_011B","no currentBatch to process",{currentBatch:h.runtime.currentBatch}),void(h.processing=!1))):(o.writeLog("INC_011D","prepareIncoming returned bad data",{success:e,data:t}),void(h.processing=!1))},h.pendingFailedReturned=function(e,t){return e||(o.writeLog("INC_011A","failed to return failed pending to sender",{success:e,data:t},!0),h.paused=!0,l.run({navClient:h.navClient},h.allPendingReturned)),h.runtime.currentBatch&&0!==s.size(h.runtime.currentBatch)?void p.run({subClient:h.subClient,chosenOutgoing:h.runtime.chosenOutgoing,numAddresses:h.runtime.numFlattened},h.retrievedSubchainAddresses):(o.writeLog("INC_011C","no currentBatch to process",{currentBatch:h.runtime.currentBatch}),void(h.processing=!1))},h.retrievedSubchainAddresses=function(e,t){return e&&t&&t.subAddresses?void m.run({currentBatch:h.runtime.currentBatch,currentFlattened:h.runtime.currentFlattened,outgoingPubKey:h.runtime.outgoingPubKey,subClient:h.subClient,navClient:h.navClient,subAddresses:t.subAddresses,settings:f},h.transactionsProcessed):(o.writeLog("INC_009","failed to retrieve subchain addresses",{success:e,data:t},!0),void l.run({navClient:h.navClient},h.allPendingReturned))},h.transactionsProcessed=function(e,t){if(!e||!t)return t&&t.partialFailure?(o.writeLog("INC_010A","failed part way through processing subchain transactions",{success:e,data:t},!0),h.paused=!0,void(h.processing=!1)):(o.writeLog("INC_010","failed to process transactions",{success:e,data:t},!0),h.paused=!0,void l.run({navClient:h.navClient},h.allPendingReturned));if(h.runtime.successfulTxGroups=t.successfulTxGroups,h.runtime.txGroupsToReturn=t.txGroupsToReturn,h.runtime.transactionsToReturn=[],h.runtime.txGroupsToReturn&&h.runtime.txGroupsToReturn.length>0){o.writeLog("INC_011","failed to process some transactions",{success:e,data:t},!0);for(var n=0;n<h.runtime.txGroupsToReturn.length;n++)for(var r=h.runtime.txGroupsToReturn[n],i=0;i<r.transactions.length;i++)h.runtime.transactionsToReturn.push(r.transactions[i]);return void l.fromList({navClient:h.navClient,transactionsToReturn:h.runtime.transactionsToReturn},h.failedTransactionsReturned)}h.failedTransactionsReturned(!0)},h.failedTransactionsReturned=function(e,t){e||(h.paused=!0,o.writeLog("INC_012","failed to return failed transactions to sender",{success:e,data:t},!0)),h.runtime.successfulSubTransactions=[];for(var n=0;n<h.runtime.successfulTxGroups.length;n++){var r=h.runtime.successfulTxGroups[n];s.forEach(r.transactions,function(e){h.runtime.successfulSubTransactions.push(e)})}v.run({successfulSubTransactions:h.runtime.successfulSubTransactions,holdingEncrypted:h.runtime.holdingEncrypted,navClient:h.navClient},h.spentToHolding)},h.spentToHolding=function(e,t){e||(o.writeLog("INC_013","failed to spend successful to holding",{success:e,data:t},!0),h.paused=!0,h.processing=!1),h.processing=!1},e.exports=h},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";var r=n(7),i=n(13),s=n(8),a=n(11),o=n(14),u=n(16),c=s.get("GLOBAL"),d={};d.testKeyPair=function(e,t){var n=["pubKeyFile","privKeyFile"];if(a.intersection(Object.keys(e),n).length!==n.length)return o.writeLog("ENC_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to EncryptionKeys.testKeyPair"});try{var s="NWMZ2atWCbUnVDKgmPHeTbGLmMUXZxZ3J3",u=i.createPublicKey(r.readFileSync(e.pubKeyFile)),c=u.encrypt(s,"utf8","base64",i.RSA_PKCS1_PADDING),d=i.createPrivateKey(r.readFileSync(e.privKeyFile)),l=d.decrypt(c,"base64","utf8",i.RSA_PKCS1_PADDING);if(l!==s)return o.writeLog("ENC_002","failed to decrypt",{decrypted:l,address:s}),void t(!1,{message:"failed to decrypt"});r.readFile(e.pubKeyFile,"utf-8",function(e,n){return e?(o.writeLog("ENC_003","failed to get public key contents",{error:e,fileData:n}),void t(!1,{message:e})):void t(!0,{publicKey:n})})}catch(e){o.writeLog("ENC_004","failed to encrypt",{error:e}),t(!1,{message:"failed to encrypt"})}},d.getEncryptionKeys=function(e,t){var n=new Date,i=d.getMidnight(n),s=u.keyFolders.private.path+i+u.keyFolders.private.suffix,a=u.keyFolders.public.path+i+u.keyFolders.public.suffix;r.exists(s,function(e){r.exists(a,function(n){return e&&n?void t(!0,{privKeyFile:s,pubKeyFile:a}):void d.generateKeys({privKeyFile:s,pubKeyFile:a},t)})})},d.generateKeys=function(e,t){var n=["pubKeyFile","privKeyFile"];if(a.intersection(Object.keys(e),n).length!==n.length)return o.writeLog("ENC_005","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to EncryptionKeys.generateKeys"});var s=u.encryptionStrength[c.serverType],d=new i.generatePrivateKey(s,65537),l=d.toPrivatePem().toString("ascii"),g=d.toPublicPem().toString("ascii");r.writeFile(e.privKeyFile,l,function(n){return n?(o.writeLog("ENC_005","unable to write private key to file system",{privKeyFile:e.privKeyFile,error:n}),void t(!1,{message:"unable to write private key to file system"})):void r.writeFile(e.pubKeyFile,g,function(n){return n?(o.writeLog("ENC_007","unable to write public key to file system",{pubKeyFile:e.pubKeyFile,error:n}),void t(!1)):void t(!0,{privKeyFile:e.privKeyFile,pubKeyFile:e.pubKeyFile})})})},d.findKeysToRemove=function(e,t){var n=["type"];return a.intersection(Object.keys(e),n).length!==n.length?(o.writeLog("ENC_008","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to EncryptionKeys.findKeysToRemove"})):void r.readdir(u.keyFolders[e.type].path,function(n,r){if(n)return o.writeLog("ENC_009","failed to open the keys directory",{error:n,files:r}),void t(!1,{message:"failed to open directory"});for(var i=new Date,s=d.getMidnight(i),a=[],c=0;c<r.length;c++){var l=new Date(parseInt(r[c].split("_")[0],10)),g=d.getMidnight(l),p=s-g;p>u.keyPeriod&&a.push(r[c])}a.length>0?d.removeKeys({forRemoval:a,type:e.type},t):"private"===e.type?d.findKeysToRemove({type:"public"},t):t(!0,{message:"nothing to remove"})})},d.removeKeys=function(e,t){0===e.forRemoval.length?"private"===e.type?d.findKeysToRemove({type:"public"},t):t(!0,{message:"all keys removed"}):r.exists(u.keyFolders[e.type].path+e.forRemoval[0],function(n){n?r.unlink(u.keyFolders[e.type].path+e.forRemoval[0],function(n){n&&o.writeLog("ENC_010","failed to remove the key",{error:n,key:e.forRemoval}),d.removeKeys({forRemoval:e.forRemoval.slice(1),type:e.type},t)}):d.removeKeys({forRemoval:e.forRemoval.slice(1),type:e.type},t)})},d.getMidnight=function(e){return parseInt(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),10)},e.exports=d},function(e,t){e.exports=require("ursa")},function(e,t,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(15),s=n(8),a=s.get("GLOBAL"),o=!1;"INCOMING"===a.serverType&&(o=s.get("INCOMING")),"OUTGOING"===a.serverType&&(o=s.get("OUTGOING"));var u=n(16),c=u.version.major+"."+u.version.minor+"."+u.version.patch,d=encodeURIComponent(o.smtp.user)+":"+encodeURIComponent(o.smtp.pass),l={};l.transporter=i.createTransport("smtps://"+d+"@"+o.smtp.server);var g=new Date,p="\r\n";p+="Version: "+c+"\r\n",p+="Date: "+g+"\r\n",p+="\r\n-----------------------------------------------------------\r\n",console.log(p),l.writeLog=function(e,t,n,i){i&&l.sendMail(e,t,n);var s=new Date,a="\r\n";a+="Date: "+s+"\r\n",a+="Error Code: "+e+"\r\n",a+="Error Message: "+t+"\r\n";for(var o in n)if(n.hasOwnProperty(o)){var u=n[o];"object"===r(n[o])&&(u=JSON.stringify(n[o])),a+=o+": "+u+"\r\n"}a+="\r\n-----------------------------------------------------------\r\n",console.log(a)},l.sendMail=function(e,t,n){var r={from:'"Navtech System" <'+o.smtp.user+">",to:o.notificationEmail,subject:"Navtech System Message - "+o.local.ipAddress+" ("+a.serverType+") "+e,text:e+" - "+t,attachments:[{filename:"data.json",content:JSON.stringify(n)}]};l.transporter.sendMail(r,function(e,t){return e?console.log("nodemail error",e):console.log("nodemail success: "+t.response)})},e.exports=l},function(e,t){e.exports=require("nodemailer")},function(e,t){e.exports={version:{major:1,minor:2,patch:0},keyFolders:{private:{path:"./keys/private/",suffix:"_private.pem"},public:{path:"./keys/public/",suffix:"_public.pub"}},keyPeriod:6048e5,minKeyStamp:14647392e5,account:{INCOMING:"incomingAccount",OUTGOING:"outgoingAccount",HOLDING:"holdingAccount"},maxAddresses:1e3,maxHolding:200,minNavTransactions:3,maxNavTransactions:8,txFee:1e-4,maxEncryptionAttempts:10,encryptionStrength:{INCOMING:2048,OUTGOING:1024},encryptionOutput:{INCOMING:344,OUTGOING:172},subCoinsPerTx:1,subChainTxFee:1e-4,minConfs:1,maxConfs:60,maxQueue:120,blockThreshold:{checking:5,processing:3}}},function(e,t,n){"use strict";var r=n(11),i=n(16),s=n(14),a=n(18),o={};o.run=function(e,t){var n=["navClient","subClient","settings"];return r.intersection(Object.keys(e),n).length!==n.length?(s.writeLog("PRE_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to Preflight.checkNavBlocks"})):(o.runtime={callback:t,navClient:e.navClient,subClient:e.subClient,settings:e.settings},void a.checkBlockHeight({client:o.runtime.navClient,blockThreshold:i.blockThreshold.processing},o.navBlocksChecked))},o.navBlocksChecked=function(e,t){return e&&t?(o.runtime.navBalance=t.balance,void o.runtime.navClient.setTxFee(parseFloat(i.txFee)).then(function(){a.checkBlockHeight({client:o.runtime.subClient,blockThreshold:i.blockThreshold.processing},o.subBlocksChecked)}).catch(function(e){s.writeLog("PRE_003","failed to set NAV tx fee",{err:e}),o.runtime.callback(!1,{message:"failed to set NAV tx fee"})})):(s.writeLog("PRE_002","navClient block check failed",{status:e,data:t}),void o.runtime.callback(!1,{message:"navClient block check failed"}))},o.subBlocksChecked=function(e,t){return e&&t?(o.runtime.subBalance=t.balance,void a.unlockWallet({settings:o.runtime.settings,client:o.runtime.navClient,type:"navCoin"},o.navClientUnlocked)):(s.writeLog("PRE_004","subClient block check failed",{status:e,data:t}),void o.runtime.callback(!1,{message:"subClient block check failed"}))},o.navClientUnlocked=function(e,t){return e?void a.unlockWallet({settings:o.runtime.settings,client:o.runtime.subClient,type:"subChain"},o.subClientUnlocked):(s.writeLog("PRE_005","navClient failed to unlock",{status:e,data:t}),void o.runtime.callback(!1,{message:"navClient failed to unlock"}))},o.subClientUnlocked=function(e,t){return e?void o.runtime.subClient.setTxFee(parseFloat(i.subChainTxFee)).then(function(){o.runtime.callback(!0,{navBalance:o.runtime.navBalance,subBalance:o.runtime.subBalance})}).catch(function(e){s.writeLog("PRE_003","failed to set SUB tx fee",{err:e}),o.runtime.callback(!1,{message:"failed to set SUB tx fee"})}):(s.writeLog("PRE_006","subClient failed to unlock",{status:e,data:t}),void o.runtime.callback(!1,{message:"subClient failed to unlock"}))},e.exports=o},function(e,t,n){"use strict";var r=n(8),i=n(11),s=n(14),a=r.get("GLOBAL"),o={};o.unlockWallet=function(e,t){var n=["settings","client","type"];if(i.intersection(Object.keys(e),n).length!==n.length)return s.writeLog("NAV_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to NavCoin.unlockWallet"});if(a.encryptedWallet===!1)return void t(!0);var r=e.settings.scriptInterval/1e3;e.client.walletPassphrase(e.settings[e.type].walletPassphrase,r).then(function(){t(!0)}).catch(function(n){switch(n.code){case-17:t(!0);break;default:return t(!1,{message:"failed to unlock"}),void s.writeLog("NAV_002","failed to unlock "+e.type+" wallet",{error:n})}})},o.lockWallet=function(e,t){var n=["type","client"];return i.intersection(Object.keys(e),n).length!==n.length?(s.writeLog("NAV_003","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to NavCoin.lockWallet"})):void e.client.walletLock().then(function(){s.writeLog("NAV_004","locked the "+e.type+" wallet",e),o.unlockWallet(e,t)}).catch(function(n){t(!1,{message:"failed to lock"}),s.writeLog("NAV_005","failed to lock "+e.type+" wallet",{error:n})})},o.filterUnspent=function(e,t){var n=["unspent","client","accountName"];if(i.intersection(Object.keys(e),n).length!==n.length)return s.writeLog("NAV_006","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to NavCoin.filterUnspent"});try{e.client.getAddressesByAccount(e.accountName).then(function(n){var r=!1,i=[],s=!0,a=!1,o=void 0;try{for(var u,c=e.unspent[Symbol.iterator]();!(s=(u=c.next()).done);s=!0){var d=u.value;n.indexOf(d.address)!==-1&&(r=!0,i.push(d))}}catch(e){a=!0,o=e}finally{try{!s&&c.return&&c.return()}finally{if(a)throw o}}return r?void t(!0,{currentPending:i}):void t(!0)}).catch(function(n){s.writeLog("NAV_007","failed to get address by account",{error:n,options:e}),t(!1)})}catch(t){s.writeLog("NAV_008","failed to filter",{error:t,options:e})}},o.checkBlockHeight=function(e,t){var n=["client","blockThreshold"];return i.intersection(Object.keys(e),n).length!==n.length?(s.writeLog("NAV_009","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to NavCoin.checkBlockHeight"})):void e.client.getInfo().then(function(n){e.client.getBlockCount().then(function(r){return parseInt(r,10)-e.blockThreshold>parseInt(n.blocks,10)?(s.writeLog("NAV_010","client is not synced with the latest blocks",{walletInfo:n,blockCount:r}),void t(!1,{message:"client is not synced with the latest blocks"})):void t(!0,{balance:n.balance})}).catch(function(n){s.writeLog("NAV_011","failed to get block count",{error:n,options:e}),t(!1,{message:"failed to get block count"})})}).catch(function(n){s.writeLog("NAV_012","failed to get info",{error:n,options:e}),t(!1,{message:"failed to get info"})})},o.validateAddresses=function(e,t){var n=["client","addresses"];return i.intersection(Object.keys(e),n).length!==n.length?(s.writeLog("NAV_013","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to NavCoin.validateAddresses"})):0===e.addresses.length?void t(!0):void e.client.validateAddress(e.addresses[0]).then(function(n){return n.isvalid!==!0?(s.writeLog("NAV_014","provided address is invalid",{address:e.addresses[0]}),void t(!1,{message:"provided address is invalid"})):void o.validateAddresses({addresses:e.addresses.slice(1),client:e.client},t)}).catch(function(n){s.writeLog("NAV_015","failed to validate address",{error:n,options:e}),t(!1,{message:"failed to validate address"})})},e.exports=o},function(e,t,n){"use strict";var r=n(11),i=n(16),s=n(14),a=n(18),o=n(20),u=n(21),c=n(22),d={};d.run=function(e,t){var n=["navClient"];return r.intersection(Object.keys(e),n).length!==n.length?(s.writeLog("RFL_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to RefillOutgoing.checkHoldingAccount"})):(d.runtime={callback:t,navClient:e.navClient},void d.getUnspent())},d.getUnspent=function(){d.runtime.navClient.listUnspent().then(function(e){return e.length<1?(s.writeLog("RFL_002","no unspent in holding account",{unspent:e}),void d.runtime.callback(!0,{message:"no unspent in holding account"})):void a.filterUnspent({unspent:e,client:d.runtime.navClient,accountName:i.account.HOLDING},d.holdingFiltered)}).catch(function(e){s.writeLog("RFL_003","failed to list unspent",{error:e}),d.runtime.callback(!1,{message:"failed to list unspent"})})},d.holdingFiltered=function(e,t){return!e||!t||!t.currentPending||t.currentPending.length<1?void d.runtime.callback(!0,{message:"no pending to clear from account"}):(d.runtime.currentHolding=t.currentPending,void d.processHolding())},d.processHolding=function(){return d.runtime.currentHolding.length<1?(s.writeLog("RFL_005","all holding processed",{currentHolding:d.runtime.currentHolding}),void d.runtime.callback(!0,{message:"all holding processed"})):void d.checkIfHoldingIsSpendable()},d.checkIfHoldingIsSpendable=function(){return d.runtime.currentHolding[0].confirmations>i.minConfs?void o.getEncrypted({transaction:d.runtime.currentHolding[0],client:d.runtime.navClient},d.holdingDecrypted):(s.writeLog("RFL_006","holding account transaction not spendable",{currentHolding:d.runtime.currentHolding}),d.runtime.currentHolding.splice(0,1),void d.processHolding())},d.holdingDecrypted=function(e,t){if(!(e&&t&&t.decrypted&&t.transaction))return s.writeLog("RFL_007","failed to decrypt holding transaction data",{success:e,data:t}),d.runtime.currentHolding.splice(0,1),void d.processHolding();if(d.runtime.holdingTransaction=t.transaction,t.decrypted.constructor!==Array)return s.writeLog("RFL_007A","decrypted data not an array",{currentHolding:d.runtime.currentHolding}),d.runtime.currentHolding.splice(0,1),void d.processHolding();var n=t.decrypted.slice(0);if(n.constructor!==Array)return s.writeLog("RFL_007A","decrypted data not an array of addresses",{currentHolding:d.runtime.currentHolding}),d.runtime.currentHolding.splice(0,1),void d.processHolding();for(var r=Math.ceil(Math.random()*(n.length-(i.minNavTransactions-1)))+(i.minNavTransactions-1),a=[];a.length<r;){
var o=Math.floor(Math.random()*n.length);a.push(n[o]),n.splice(o,1)}c.incoming({totalToSend:t.transaction.amount,addresses:a},d.checkRandomTransactions)},d.checkRandomTransactions=function(e,t){return!e||!t||!t.transactions||t.transactions.length<1?(s.writeLog("RFL_008","failed to randomize transactions",{success:e,data:t}),d.runtime.currentHolding.splice(0,1),void d.processHolding()):void d.sendRawRefillTransaction(t.transactions)},d.sendRawRefillTransaction=function(e){var t=[{txid:d.runtime.holdingTransaction.txid,vout:parseInt(d.runtime.holdingTransaction.vout,10)}];u.createRaw({outgoingTransactions:e,spentTransactions:t,client:d.runtime.navClient},d.refillSent)},d.refillSent=function(e,t){e&&t&&t.rawOutcome||s.writeLog("RFL_009","failed to send raw refill transaction",{holdingTxid:d.runtime.holdingTransaction.txid,holdingTransaction:d.runtime.holdingTransaction},!0),d.runtime.currentHolding.splice(0,1),d.processHolding()},e.exports=d},function(e,t,n){"use strict";var r=n(7),i=n(13),s=n(8),a=n(11),o=n(14),u=n(16),c=s.get("GLOBAL"),d={};d.getEncrypted=function(e,t){var n=["transaction","client"];return a.intersection(Object.keys(e),n).length!==n.length?(o.writeLog("ECD_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to EncryptedData.getEncrypted"})):(d.runtime={callback:t,transaction:e.transaction,client:e.client},void e.client.getTransaction(e.transaction.txid).then(function(n){var r="INCOMING"===c.serverType?n["anon-destination"]:n["tx-comment"];d.decryptData({encryptedData:r,transaction:e.transaction},t)}).catch(function(n){o.writeLog("ECD_002","failed to get transation",{transaction:e.transaction,error:n}),t(!1,{message:"failed to get transation"})}))},d.decryptData=function(e,t){var n=["encryptedData"];return a.intersection(Object.keys(e),n).length!==n.length?(o.writeLog("ECD_003","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to EncryptedData.decryptData"})):(d.runtime={callback:t,transaction:e.transaction,encryptedData:e.encryptedData},void r.readdir(u.keyFolders.private.path,function(n,s){if(n)return t(!1,{message:"failed to read the keyfolder"}),void o.writeLog("ECD_010","failed to read the keyfolder",{error:n,transaction:e.transasction});for(var a=!1,c=void 0,d=0;d<s.length;d++)if(!a)try{var l=u.keyFolders.private.path+s[d],g=i.createPrivateKey(r.readFileSync(l)),p=g.decrypt(e.encryptedData,"base64","utf8",i.RSA_PKCS1_PADDING);a=!0,c=JSON.parse(p)}catch(e){}return a&&c?void t(!0,{decrypted:c,transaction:e.transaction}):(o.writeLog("ECD_011","unable to decrypt",{decrypted:c,successfulDecryption:a,transaction:e.transasction}),void t(!1,{message:"unable to decrypt"}))}))},e.exports=d},function(e,t,n){"use strict";var r=n(8),i=n(11),s=n(14),a=n(18),o=r.get("GLOBAL"),u=!1;"INCOMING"===o.serverType&&(u=r.get("INCOMING")),"OUTGOING"===o.serverType&&(u=r.get("OUTGOING"));var c={};c.createRaw=function(e,t){var n=["spentTransactions","outgoingTransactions","client"];return i.intersection(Object.keys(e),n).length!==n.length?(s.writeLog("RAW_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to SelectOutgoing.run"})):(c.runtime={counter:0,retryDelay:6e3,spentTransactions:e.spentTransactions,outgoingTransactions:e.outgoingTransactions,client:e.client,encrypted:e.encrypted||!1,callback:t},void c.create())},c.create=function(){c.runtime.encrypted?c.runtime.client.createRawTransaction(c.runtime.spentTransactions,c.runtime.outgoingTransactions,c.runtime.encrypted).then(function(e){c.signRaw(e)}).catch(function(e){s.writeLog("RAW_002","unable to create raw transaction",{spentTransactions:c.runtime.spentTransactions,outgoingTransactions:c.runtime.outgoingTransactions,encrypted:c.runtime.encrypted,error:e}),c.retry(e)}):c.runtime.client.createRawTransaction(c.runtime.spentTransactions,c.runtime.outgoingTransactions).then(function(e){c.signRaw(e)}).catch(function(e){s.writeLog("RAW_003","unable to create raw transaction",{spentTransactions:c.runtime.spentTransactions,outgoingTransactions:c.runtime.outgoingTransactions,error:e}),c.retry(e)})},c.signRaw=function(e){c.runtime.client.signRawTransaction(e).then(function(e){c.sendRaw(e)}).catch(function(t){if(t.code===-13&&!c.runtime.triedToUnlock){c.runtime.rawTrans=e;var n=c.runtime.client.port===u.navCoin.port?"navCoin":"subChain";return void a.unlockWallet({settings:u,client:c.runtime.client,type:n},c.walletUnlocked)}s.writeLog("RAW_004","unable to sign raw transaction",{rawTrans:e,error:t}),c.retry(t)})},c.walletUnlocked=function(e,t){return e?(c.runtime.triedToUnlock=!0,void c.signRaw(c.runtime.rawTrans)):(s.writeLog("RAW_006","unable to unlock wallet",{success:e,data:t}),void c.runtime.callback(!1,t))},c.sendRaw=function(e){return o.preventSend?(s.writeLog("RAW_TEST_001","preventSend triggered",{runtime:c.runtime}),void c.runtime.callback(!0,{rawOutcome:"dummy-tx-id"})):void c.runtime.client.sendRawTransaction(e.hex).then(function(e){c.runtime.callback(!0,{rawOutcome:e})}).catch(function(t){s.writeLog("RAW_005","unable to send raw transaction",{signedRaw:e,error:t}),c.retry(t)})},c.retry=function(e){return c.runtime.counter>=10?void c.runtime.callback(!1,{error:e}):(s.writeLog("RAW_007","retrying",{error:e,counter:c.runtime.counter}),void setTimeout(function(){c.runtime.counter+=1,c.create()},c.runtime.retryDelay))},e.exports=c},function(e,t,n){"use strict";var r=n(11),i=n(14),s=n(16),a={};a.incoming=function(e,t){var n=["totalToSend","addresses"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("RND_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to RandomizeTransactions.incoming"})):(a.runtime={callback:t,totalToSend:e.totalToSend,addresses:e.addresses,transactions:{}},void a.randomizeIncoming())},a.randomizeIncoming=function(){for(var e=1e8,t=a.runtime.totalToSend*e,n=s.txFee*e,r=n*a.runtime.addresses.length,i=t-r,o=0,u=i/a.runtime.addresses.length,c=Math.floor(1.5*u*e),d=Math.floor(.5*u*e),l=0;l<a.runtime.addresses.length;l++)if(o<i){var g=Math.random()*(c-d)+d,p=Math.round(g/e);if(p>i-o||l===a.runtime.addresses.length-1){var m=Math.round(i-o);a.runtime.transactions[a.runtime.addresses[l]]=m/e,o+=m}else a.runtime.transactions[a.runtime.addresses[l]]=p/e,o+=p}a.runtime.callback(!0,{transactions:a.runtime.transactions})},a.outgoing=function(e,t){var n=["transaction","address","amount"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("RND_002","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to RandomizeTransactions.outgoing"})):(a.runtime={callback:t,transaction:e.transaction,address:e.address,amount:e.amount,transactions:[]},void a.randomizeOutgoing())},a.randomizeOutgoing=function(){for(var e=Math.ceil(Math.random()*(s.maxNavTransactions-s.minNavTransactions))+s.minNavTransactions,t=a.runtime.amount,n=1e8,r=t*n,i=0,o=r/e,u=Math.floor(1.5*o*n),c=Math.floor(.5*o*n),d=0;d<e;d++)if(i<r){var l=Math.random()*(u-c)+c,g=Math.round(l/n);if(g>r-i||d===e-1){var p=Math.round(r-i);a.runtime.transactions.push(p/n),i+=p}else a.runtime.transactions.push(g/n),i+=g}a.runtime.callback(!0,{partialTransactions:a.runtime.transactions})},a.getRandomAccountAddresses=function(e,t){var n=["client","accountName","numAddresses"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("RND_003","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to RandomizeTransactions.getRandomAccountAddresses"})):void e.client.getAddressesByAccount(e.accountName).then(function(n){a.chooseRandomAddresses({accountName:e.accountName,numAddresses:e.numAddresses,addresses:n},t)}).catch(function(n){i.writeLog("RND_004","get account address failed",{options:e,error:n}),t(!1,{message:"get account address failed"})})},a.chooseRandomAddresses=function(e,t){var n=["addresses","accountName","numAddresses"];if(r.intersection(Object.keys(e),n).length!==n.length)return i.writeLog("RND_005","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to RandomizeTransactions.chooseRandomAddresses"});for(var s=[],a=0;s.length<e.numAddresses&&a<1e4;){var o=Math.floor(Math.random()*e.addresses.length);e.addresses[o]&&(s.push(e.addresses[o]),e.addresses.splice(o,1)),a++}return s.length!==e.numAddresses?(i.writeLog("RND_006","picked addresses did not equal the number requested",{pickedAddresses:s.length,numAddresses:e.numAddresses,counter:a}),void t(!1)):void t(!0,{pickedAddresses:s})},e.exports=a},function(e,t,n){"use strict";var r=n(11),i=n(24),s=n(13),a=n(7),o=n(16),u=n(14),c=n(18),d=n(12),l={};l.run=function(e,t){var n=["settings","navClient"];return r.intersection(Object.keys(e),n).length!==n.length?(u.writeLog("SEL_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to SelectOutgoing.run"})):!e.settings.remote||e.settings.remote.length<1?(u.writeLog("SEL_002","no remote servers detected",{remoteCluster:e.settings.remote}),void t(!1,{message:"no remote servers detected"})):(l.runtime={callback:t,remoteCluster:JSON.parse(JSON.stringify(e.settings.remote)),settings:e.settings,navClient:e.navClient},void l.pickServer())},l.pickServer=function(){if(l.runtime.remoteCluster.length<1)return u.writeLog("SEL_003","no valid outgoing servers found"),void l.runtime.callback(!1,{returnAllToSenders:!0,pause:!1});var e=Math.floor(Math.random()*l.runtime.remoteCluster.length);l.runtime.chosenOutgoingIndex=e,l.runtime.chosenOutgoing=l.runtime.remoteCluster[e],l.testOutgoing(l.runtime.remoteCluster[e])},l.testOutgoing=function(e){var t=e.port?e.ipAddress+":"+e.port:e.ipAddress;l.runtime.outgoingAddress=t;var n={uri:"https://"+t+"/api/check-node",method:"POST",timeout:6e4,rejectUnauthorized:!1,requestCert:!0,agent:!1,form:{server_type:"OUTGOING",num_addresses:6}};i(n,l.gotServerResponse)},l.gotServerResponse=function(e,t,n){return e?(u.writeLog("SEL_004","failed to query outgoing server",{body:n,outgoingAddress:l.runtime.outgoingAddress,error:e}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),void l.pickServer()):void l.checkOutgoingCanTransact(n,l.runtime.outgoingAddress)},l.checkOutgoingCanTransact=function(e,t){try{var n=JSON.parse(e);if("SUCCESS"!==n.type)return u.writeLog("SEL_005","outgoing server returned failure",{body:n,outgoingAddress:t}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),void l.pickServer();if(!(n.data&&n.data.nav_addresses&&n.data.nav_balance&&n.data.public_key))return u.writeLog("SEL_006","outgoing server returned incorrect params",{body:n,outgoingAddress:t}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),void l.pickServer();if(l.runtime.outgoingServerData=n.data,l.runtime.outgoingNavBalance=n.data.nav_balance,"OUTGOING"!==l.runtime.outgoingServerData.server_type)return u.writeLog("SEL_007","outgoing server is of the wrong type",{body:l.runtime.outgoingServerData}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),void l.pickServer();var r={a:"NWMZ2atWCbUnVDKgmPHeTbGLmMUXZxZ3J3",n:"9999.99999999",s:l.runtime.settings.secret};l.checkPublicKey(r)}catch(n){return u.writeLog("SEL_005A","outgoing server returned non json response",{body:e,outgoingAddress:t}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),void l.pickServer()}},l.checkPublicKey=function(e){try{l.runtime.outgoingPubKey=s.createPublicKey(l.runtime.outgoingServerData.public_key);var t=l.runtime.outgoingPubKey.encrypt(JSON.stringify(e),"utf8","base64",s.RSA_PKCS1_PADDING);if(!t||t.length!==o.encryptionOutput.OUTGOING)return u.writeLog("SEL_008","failed to encrypt test data",{encrypted:t}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),void l.pickServer();l.hasNavAddresses()}catch(e){u.writeLog("SEL_009","bad public key provided by outgoing server",{error:e,body:l.runtime.outgoingServerData}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),l.pickServer()}},l.hasNavAddresses=function(){return l.runtime.outgoingServerData.nav_addresses.length<1?(u.writeLog("SEL_010","outgoing server did not provide at least 1 address",{body:l.runtime.outgoingServerData}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),void l.pickServer()):void c.validateAddresses({client:l.runtime.navClient,addresses:l.runtime.outgoingServerData.nav_addresses},l.navAddressesValid)},l.navAddressesValid=function(e){return e?void d.getEncryptionKeys({},l.encryptOutgoingAddresses):(u.writeLog("SEL_011","invalid nav addresses sent from the outgoing server",{addressesValid:e}),l.runtime.remoteCluster.splice(l.runtime.chosenOutgoingIndex,1),void l.pickServer())},l.encryptOutgoingAddresses=function(e,t){e&&t&&t.privKeyFile&&t.pubKeyFile||(u.writeLog("SEL_012","failed to get the current keys",{success:e,data:t}),l.runtime.callback(!1,{returnAllToSenders:!0}));try{var n=s.createPublicKey(a.readFileSync(t.pubKeyFile)),r=n.encrypt(JSON.stringify(l.runtime.outgoingServerData.nav_addresses),"utf8","base64",s.RSA_PKCS1_PADDING),i=s.createPrivateKey(a.readFileSync(t.privKeyFile)),o=i.decrypt(r,"base64","utf8",s.RSA_PKCS1_PADDING);return o!==JSON.stringify(l.runtime.outgoingServerData.nav_addresses)?(u.writeLog("SEL_013","failed to encrypt with local key",{success:e,data:t,encrypted:r,decrypted:o}),void l.runtime.callback(!1,{returnAllToSenders:!0})):void l.runtime.callback(!0,{chosenOutgoing:l.runtime.chosenOutgoing,outgoingNavBalance:l.runtime.outgoingNavBalance,outgoingPubKey:l.runtime.outgoingPubKey,holdingEncrypted:r,returnAllToSenders:!1})}catch(n){u.writeLog("SEL_014","failed to use local key",{success:e,data:t,error:n,encrypting:l.runtime.outgoingServerData.nav_addresses}),l.runtime.callback(!1,{returnAllToSenders:!0})}},e.exports=l},function(e,t){e.exports=require("request")},function(e,t,n){"use strict";var r=n(11),i=n(8),s=i.get("GLOBAL"),a=n(14),o=n(18),u=n(16),c=n(26),d={};d.run=function(e,t){var n=["navClient"];return r.intersection(Object.keys(e),n).length!==n.length?(a.writeLog("RATS_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to ReturnAllToSenders.run"})):(d.runtime={callback:t,navClient:e.navClient},void d.getUnspent())},d.fromList=function(e,t){var n=["navClient","transactionsToReturn"];r.intersection(Object.keys(e),n).length!==n.length&&(a.writeLog("RATS_001A","invalid options",{options:e,required:n}),t(!1,{message:"invalid options provided to ReturnAllToSenders.fromList"})),d.runtime={callback:t,navClient:e.navClient,transactionsToReturn:e.transactionsToReturn},d.returnToSender()},d.getUnspent=function(){d.runtime.navClient.listUnspent().then(function(e){return e.length<1?void d.runtime.callback(!1,{message:"no unspent transactions found"}):void o.filterUnspent({unspent:e,client:d.runtime.navClient,accountName:u.account[s.serverType]},d.unspentFiltered)}).catch(function(e){a.writeLog("RATS_002","failed to list unspent",e),d.runtime.callback(!1,{message:"failed to list unspent"})})},d.unspentFiltered=function(e,t){return!e||!t||!t.currentPending||t.currentPending.length<1?(a.writeLog("RATS_003","failed to filter unspent",t),void d.runtime.callback(!1,{message:"no current pending to return"})):(d.runtime.transactionsToReturn=t.currentPending,void d.returnToSender())},d.returnToSender=function(){return d.runtime.transactionsToReturn.constructor!==Array||d.runtime.transactionsToReturn.length<1?void d.runtime.callback(!0,{message:"all transactions returned to sender"}):void c.send({client:d.runtime.navClient,transaction:d.runtime.transactionsToReturn[0]},d.returnedToSender)},d.returnedToSender=function(e,t){e&&t&&t.rawOutcome||a.writeLog("RATS_004","unable to return to sender",{success:e,data:t}),d.runtime.transactionsToReturn.splice(0,1),d.returnToSender()},e.exports=d},function(e,t,n){"use strict";var r=n(11),i=n(14),s=n(16),a=n(21),o={runtime:{}};o.send=function(e,t){var n=["client","transaction"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("RTS_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to ReturnAllToSenders.run"})):(o.runtime={},void e.client.getRawTransaction(e.transaction.txid).then(function(n){o.decodeOriginRaw({transaction:e.transaction,client:e.client,incomingRaw:n},t)}).catch(function(n){i.writeLog("RTS_002","unable to get raw transaction",{transaction:e.transaction,error:n}),t(!1,{message:"unable to get raw transaction"})}))},o.decodeOriginRaw=function(e,t){e.client.decodeRawTransaction(e.incomingRaw).then(function(n){o.getOriginRaw({transaction:e.transaction,client:e.client,incomingTrans:n},t)}).catch(function(n){i.writeLog("RTS_003","unable to decode raw transaction",{transaction:e.transaction,incomingRaw:e.incomingRaw,error:n}),t(!1,{message:"unable to decode raw transaction"})})},o.getOriginRaw=function(e,t){e.client.getRawTransaction(e.incomingTrans.vin[0].txid).then(function(n){o.decodeOriginInputRaw({transaction:e.transaction,client:e.client,incomingTrans:e.incomingTrans,inputRaw:n},t)}).catch(function(n){i.writeLog("RTS_004","unable to get the origins raw transaction",{transaction:e.transaction,incomingTrans:e.incomingTrans,error:n}),t(!1,{message:"unable to get the origins raw transaction"})})},o.decodeOriginInputRaw=function(e,t){e.client.decodeRawTransaction(e.inputRaw).then(function(n){var r=n.vout[e.incomingTrans.vin[0].vout].scriptPubKey.addresses[0];o.buildTransaction({transaction:e.transaction,client:e.client,origin:r},t)}).catch(function(n){i.writeLog("RTS_005","unable to decode raw incoming transaction",{transaction:e.transaction,inputRaw:e.inputRaw,error:n}),t(!1,{message:"unable to decode raw incoming transaction"})})},o.buildTransaction=function(e,t){var n={},r=1e8,i=e.transaction.amount-s.txFee,o=Math.round(i*r);n[e.origin]=o/r;var u=[{txid:e.transaction.txid,vout:e.transaction.vout}];a.createRaw({outgoingTransactions:n,spentTransactions:u,client:e.client},t)},e.exports=o},function(e,t,n){"use strict";var r=n(11),i=n(8),s=i.get("GLOBAL"),a=n(16),o=n(14),u=n(18),c=n(28),d=n(29),l={};l.run=function(e,t){var n=["navClient","outgoingNavBalance","subBalance","settings"];return r.intersection(Object.keys(e),n).length!==n.length?(o.writeLog("PREPI_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to ReturnAllToSenders.run"})):(l.runtime={callback:t,navClient:e.navClient,outgoingNavBalance:e.outgoingNavBalance,subBalance:e.subBalance,currentFlattened:{},currentBatch:[],numFlattened:0,settings:e.settings},void l.getUnspent())},l.getUnspent=function(){l.runtime.navClient.listUnspent().then(function(e){return e.length<1?void l.runtime.callback(!1,{message:"no unspent transactions found"}):void u.filterUnspent({unspent:e,client:l.runtime.navClient,accountName:a.account[s.serverType]},l.unspentFiltered)}).catch(function(e){o.writeLog("PREPI_002","failed to list unspent",e),l.runtime.callback(!1,{message:"failed to list unspent",err:e})})},l.unspentFiltered=function(e,t){return!e||!t||!t.currentPending||t.currentPending.length<1?(o.writeLog("PREPI_003","failed to filter unspent",t),void l.runtime.callback(!1,{message:"no current pending to return"})):(l.runtime.currentPending=t.currentPending,void d.run({currentPending:t.currentPending,client:l.runtime.navClient},l.partialsGrouped))},l.partialsGrouped=function(e,t){return e&&t||(o.writeLog("PREPI_003A","GroupPartials failed",{success:e,data:t}),l.runtime.callback(!1,{pendingToReturn:t?t.transactionsToReturn:null})),t.readyToProcess?(l.runtime.transactionsToReturn=t.transactionsToReturn?t.transactionsToReturn:null,void l.pruneUnspent({readyToProcess:t.readyToProcess,client:l.runtime.navClient,subBalance:l.runtime.subBalance,maxAmount:l.runtime.outgoingNavBalance},l.unspentPruned)):(o.writeLog("PREPI_003AA","GroupPartials failed to return correct data",{data:t}),void l.runtime.callback(!1,{pendingToReturn:t.transactionsToReturn?t.transactionsToReturn:null}))},l.pruneUnspent=function(e,t){if(!e.readyToProcess||!parseFloat(e.subBalance)||!parseFloat(e.maxAmount))return o.writeLog("PREPI_003B","pruneIncomingUnspent invalid params",{options:e}),void t(!1,{message:"invalid params"});var n=[],i=!1,s=0;r.forEach(e.readyToProcess,function(t){(n.length+1)*(parseFloat(a.subCoinsPerTx)+parseFloat(a.subChainTxFee))<=e.subBalance&&s+t.amount<parseFloat(e.maxAmount)&&(s+=t.amount,i=!0,n.push(t))}),i?t(!0,{currentBatch:n,sumPending:s}):t(!0,{message:"no pruned"})},l.unspentPruned=function(e,t){return!e||!t||!t.currentBatch||t.currentBatch.length<1?!l.runtime.transactionsToReturn||l.runtime.transactionsToReturn<1?(o.writeLog("PREPI_003D","no pruned and none to return",{success:e,data:t}),void l.runtime.callback(!1,{pendingToReturn:l.runtime.transactionsToReturn})):(o.writeLog("PREPI_003C","no pruned but some to return",{success:e,data:t}),void l.runtime.callback(!0,{pendingToReturn:l.runtime.transactionsToReturn})):(l.runtime.remainingToFlatten=t.currentBatch.slice(0),l.runtime.currentBatch=t.currentBatch.slice(0),void c.incoming({amountToFlatten:l.runtime.remainingToFlatten[0].amount,anonFeePercent:l.runtime.settings.anonFeePercent},l.flattened))},l.flattened=function(e,t){return e&&t&&t.flattened?l.runtime.numFlattened+t.flattened.length>=a.maxAddresses?void l.runtime.callback(!0,{currentBatch:l.runtime.currentBatch,currentFlattened:l.runtime.currentFlattened,numFlattened:l.runtime.numFlattened,pendingToReturn:l.runtime.transactionsToReturn}):(l.runtime.numFlattened+=t.flattened.length,l.runtime.currentFlattened[l.runtime.remainingToFlatten[0].unique]=t.flattened,l.runtime.remainingToFlatten.splice(0,1),0===l.runtime.remainingToFlatten.length?void l.runtime.callback(!0,{currentBatch:l.runtime.currentBatch,currentFlattened:l.runtime.currentFlattened,numFlattened:l.runtime.numFlattened,pendingToReturn:l.runtime.transactionsToReturn}):void c.incoming({amountToFlatten:l.runtime.remainingToFlatten[0].amount,anonFeePercent:l.runtime.settings.anonFeePercent},l.flattened)):(o.writeLog("PREPI_004","failed to flatten transactions",{success:e,data:t,runtime:l.runtime}),l.runtime.remainingToFlatten.splice(0,1),0===l.runtime.remainingToFlatten.length?void l.runtime.callback(!0,{currentBatch:l.runtime.currentBatch,currentFlattened:l.runtime.currentFlattened,numFlattened:l.runtime.numFlattened,pendingToReturn:l.runtime.transactionsToReturn}):void c.incoming({amountToFlatten:l.runtime.remainingToFlatten[0].amount,anonFeePercent:l.runtime.settings.anonFeePercent},l.flattened))},e.exports=l},function(e,t,n){"use strict";var r=n(11),i=n(14),s={};s.incoming=function(e,t){var n=["amountToFlatten","anonFeePercent"];if(r.intersection(Object.keys(e),n).length!==n.length)return i.writeLog("FLT_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to FlattenTransactions.incoming"});var a=e.amountToFlatten/(1+e.anonFeePercent/100);s.runtime={callback:t,amountToFlatten:s.satoshiParser(a)},s.flattenIncoming()},s.flattenIncoming=function(){for(var e=Math.floor(s.runtime.amountToFlatten),t=e.toString(),n=s.runtime.amountToFlatten-e,a=s.satoshiParser(n),o=[],u=0;u<t.length;u++)for(var c=1*Math.pow(10,t.length-(u+1)),d=parseInt(t[u],10),l=0;l<d;l++)a>0&&r.sum(o)===e-c?o.push(s.satoshiParser(parseInt(c,10)+a)):o.push(parseInt(c,10));if(1===o.length){o=[];for(var g=0;g<10;g++)a>0&&9===g?o.push(s.satoshiParser(e/10+a)):o.push(e/10)}var p=o.reduce(function(e,t){return t+e},0),m=s.satoshiParser(p);return m!==s.runtime.amountToFlatten?(i.writeLog("FLT_002","unable to correctly flatten amount",{runtime:s.runtime,flattened:o}),void s.runtime.callback(!1,{flattened:o})):void s.runtime.callback(!0,{flattened:o})},s.satoshiParser=function(e){var t=1e8;return Math.round(e*t)/t},e.exports=s},function(e,t,n){"use strict";var r=n(11),i=n(14),s=n(20),a=n(16),o={};o.run=function(e,t){var n=["currentPending","client"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("GRP_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to GroupPartials.run"})):(o.runtime={client:e.client,currentPending:e.currentPending,remainingToDecrypt:e.currentPending,transactionsToReturn:[],readyToProcess:{},partials:{},callback:t},void o.getDecryptedData())},o.getDecryptedData=function(){return o.runtime.remainingToDecrypt.length<1?void o.checkPartials():void s.getEncrypted({transaction:o.runtime.remainingToDecrypt[0],client:o.runtime.client},o.checkDecrypted)},o.partialFailed=function(e){var t=r.findIndex(o.runtime.transactionsToReturn,function(t){return t.txid===e.txid});t===-1&&o.runtime.transactionsToReturn.push(e),o.runtime.remainingToDecrypt.splice(0,1),o.getDecryptedData()},o.checkDecrypted=function(e,t){return e&&t&&t.decrypted&&t.transaction?t.decrypted.n&&t.decrypted.t&&t.decrypted.p&&t.decrypted.o&&t.decrypted.u?void o.runtime.client.validateAddress(t.decrypted.n).then(function(n){return n.isvalid!==!0?(i.writeLog("GRP_003A","encrypted address invalid",{success:e,data:t}),void o.partialFailed(t.transaction)):void o.groupPartials(t.decrypted,t.transaction)}).catch(function(n){i.writeLog("GRP_003B","failed to decrypt transaction data",{success:e,error:n}),o.partialFailed(t.transaction)}):(i.writeLog("GRP_003","failed to receive correct encrypted params",{n:!!t.decrypted.n,t:t.decrypted.t,p:t.decrypted.p,o:t.decrypted.o,u:t.decrypted.u,data:t}),void o.partialFailed(t.transaction)):(i.writeLog("GRP_002","failed to decrypt transaction data",{success:e}),void o.partialFailed(o.runtime.remainingToDecrypt[0]))},o.groupPartials=function(e,t){if(o.runtime.partials[e.u]||(o.runtime.partials[e.u]={destination:e.n,unique:e.u,timeDelay:parseInt(e.t,10),parts:parseInt(e.o,10),partsSum:0,amount:0,transactions:{},readyToProcess:!1}),o.runtime.partials[e.u].readyToProcess===!0)return i.writeLog("GRP_006","this partial group is already flagged as completed",{partials:o.runtime.partials[e.u],transaction:t,n:!!e.n,t:e.t,p:e.p,o:e.o,u:e.u}),void o.partialFailed(t);if(o.runtime.partials[e.u].destination!==e.n)return i.writeLog("GRP_004","decrypted address different from other partials",{partials:o.runtime.partials[e.u],transaction:t}),void o.partialFailed(t);if(o.runtime.partials[e.u].transactions[t.txid])return i.writeLog("GRP_005","txid already processed",{partials:o.runtime.partials[e.u],transaction:t}),void o.partialFailed(t);var n=Math.round(1e8*o.runtime.partials[e.u].amount),s=Math.round(1e8*t.amount),a=(n+s)/1e8;o.runtime.partials[e.u].amount=a,o.runtime.partials[e.u].partsSum+=parseInt(e.p,10),o.runtime.partials[e.u].transactions[t.txid]={txid:t.txid,amount:t.amount,confirmations:t.confirmations,vout:t.vout,vin:t.vin,part:e.p};var u=o.runtime.partials[e.u].parts,c=r.size(o.runtime.partials[e.u].transactions);c===u&&u*(u+1)/2===o.runtime.partials[e.u].partsSum&&(o.runtime.partials[e.u].readyToProcess=!0,o.runtime.readyToProcess[e.u]=o.runtime.partials[e.u]),o.runtime.remainingToDecrypt.splice(0,1),o.getDecryptedData()},o.checkPartials=function(){r.forEach(o.runtime.partials,function(e){e.readyToProcess||r.forEach(e.transactions,function(e){var t=r.findIndex(o.runtime.transactionsToReturn,function(t){return t.txid===e.txid});t===-1&&e.confirmations>a.maxConfs&&o.runtime.transactionsToReturn.push(e)})}),o.runtime.callback(!0,{readyToProcess:o.runtime.readyToProcess,transactionsToReturn:o.runtime.transactionsToReturn})},e.exports=o},function(e,t,n){"use strict";var r=n(11),i=n(24),s=n(14),a=n(18),o={};o.run=function(e,t){var n=["subClient","chosenOutgoing","numAddresses"];return r.intersection(Object.keys(e),n).length!==n.length?(s.writeLog("RSC_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to RetrieveSubchainAddresses.run"})):(o.runtime={callback:t,subClient:e.subClient,chosenOutgoing:e.chosenOutgoing,numAddresses:e.numAddresses},void o.getSubAddresses())},o.getSubAddresses=function(){var e=o.runtime.chosenOutgoing,t=e.port?e.ipAddress+":"+e.port:e.ipAddress;o.runtime.outgoingAddress=t;var n={uri:"https://"+t+"/api/get-addresses",method:"POST",timeout:6e4,rejectUnauthorized:!1,requestCert:!0,agent:!1,form:{type:"SUBCHAIN",account:"OUTGOING",num_addresses:o.runtime.numAddresses}};i(n,o.requestResponse)},o.requestResponse=function(e,t,n){return e?(s.writeLog("RSC_004","failed to query outgoing server",{error:e,outgoingAddress:o.runtime.outgoingAddress}),void o.runtime.callback(!1,{message:"failed to query outgoing server"})):void o.checkOutgoingCanTransact(n,o.runtime.outgoingAddress)},o.checkOutgoingCanTransact=function(e,t){try{var n=JSON.parse(e);if("SUCCESS"!==n.type)return s.writeLog("RSC_005","outgoing server returned failure",{body:n,outgoingAddress:t}),void o.runtime.callback(!1,{message:"outgoing server returned failure"});if(!n.data||!n.data.addresses||n.data.addresses.constructor!==Array)return s.writeLog("RSC_006","outgoing server returned incorrect params",{body:n,outgoingAddress:t}),void o.runtime.callback(!1,{message:"outgoing server returned failure"});o.checkSubAddresses(n.data.addresses)}catch(n){return s.writeLog("RSC_005A","outgoing server returned non json response",{body:e,error:n,outgoingAddress:t}),void o.runtime.callback(!1,{message:"outgoing server returned non json response"})}},o.checkSubAddresses=function(e){return e.length<1?(s.writeLog("RSC_007","outgoing server must provide at least one sub address",{subAddresses:e}),void o.runtime.callback(!1,{message:"outgoing server must provide at least one sub address"})):e.length<o.runtime.numAddresses?(s.writeLog("RSC_008","outgoing server did not provide enough sub addresses",{subAddressesLength:e.length,numAddresses:o.runtime.numAddresses}),void o.runtime.callback(!1,{message:"outgoing server did not provide enough sub addresses"})):(o.runtime.outgoingSubAddresses=e,void a.validateAddresses({client:o.runtime.subClient,addresses:e},o.subAddressesValid))},o.subAddressesValid=function(e){return e?void o.runtime.callback(!0,{subAddresses:o.runtime.outgoingSubAddresses}):(s.writeLog("RSC_009","invalid subchain addresses received",{subAddresses:o.runtime.outgoingSubAddresses}),void o.runtime.callback(!1,{message:"invalid subchain addresses received"}))},e.exports=o},function(e,t,n){"use strict";var r=n(11),i=n(13),s=n(14),a=n(16),o=n(32),u={};u.run=function(e,t){var n=["currentBatch","settings","subClient","outgoingPubKey","subAddresses","navClient","currentFlattened"];return r.intersection(Object.keys(e),n).length!==n.length?(s.writeLog("PROI_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to ProcessIncoming.run"})):(u.runtime={callback:t,currentBatch:e.currentBatch,remainingTxGroups:e.currentBatch,currentFlattened:e.currentFlattened,settings:e.settings,subClient:e.subClient,navClient:e.navClient,outgoingPubKey:e.outgoingPubKey,subAddresses:e.subAddresses,txGroupsToReturn:[],successfulTxGroups:[]},void u.runtime.navClient.getBlockCount().then(function(e){u.runtime.currentBlockHeight=e,u.processPending()}).catch(function(e){s.writeLog("PROI_001A","failed to get the current blockheight",{error:e}),t(!1,{message:"failed to get the current blockheight"})}))},u.processPending=function(){if(r.size(u.runtime.remainingTxGroups)<1)return void u.runtime.callback(!0,{successfulTxGroups:u.runtime.successfulTxGroups,txGroupsToReturn:u.runtime.txGroupsToReturn});var e=u.runtime.remainingTxGroups[0];u.runtime.remainingFlattened=u.runtime.currentFlattened[e.unique],u.runtime.destination=e.destination,u.runtime.maxDelay=e.timeDelay,u.processPartial()},u.processPartial=function(){return u.runtime.remainingFlattened.length<1?(u.runtime.successfulTxGroups.push(u.runtime.remainingTxGroups[0]),u.runtime.remainingTxGroups.splice(0,1),void u.processPending()):void u.reEncryptAddress(u.runtime.destination,u.runtime.maxDelay,u.runtime.remainingTxGroups[0],u.runtime.remainingFlattened[0],0)},u.partialFailed=function(e){var t=u.runtime.remainingTxGroups[0];return u.runtime.currentFlattened[t.unique].length>u.runtime.remainingFlattened.length?(s.writeLog("PROI_009","partial subchain transaction failure",{
txGroup:e,runtime:u.runtime}),void u.runtime.callback(!1,{partialFailure:!0})):(s.writeLog("PROI_009A","complete group failure",{txGroup:e,runtime:u.runtime}),u.runtime.txGroupsToReturn.push(t),u.runtime.remainingTxGroups.splice(0,1),void u.processPending())},u.reEncryptAddress=function(e,t,n,r,o){try{var c={n:e,v:r,s:u.runtime.settings.secret,t:u.runtime.currentBlockHeight+Math.round(Math.random()*t)},d=u.runtime.outgoingPubKey.encrypt(JSON.stringify(c),"utf8","base64",i.RSA_PKCS1_PADDING);if(d.length!==a.encryptionOutput.OUTGOING&&o<a.maxEncryptionAttempts)return s.writeLog("PROI_005","public key encryption failed",{maxDelay:t,txGroup:n,flattened:r,counter:o,encrypted:d}),void(u.reEncryptAddress=o+1);if(d.length!==a.encryptionOutput.OUTGOING&&o>=a.maxEncryptionAttempts)return s.writeLog("PROI_006","max public key encryption failures",{txGroup:n,counter:o,encrypted:d}),void u.partialFailed(n);u.makeSubchainTx(d,n)}catch(e){return s.writeLog("PROI_007","encrypted address invalid",{txGroup:n,error:e}),void u.partialFailed(n)}},u.makeSubchainTx=function(e,t){o.send({client:u.runtime.subClient,address:u.runtime.subAddresses[0],amount:a.subCoinsPerTx,transaction:t,encrypted:e},u.sentSubToOutgoing)},u.sentSubToOutgoing=function(e,t){return e&&t&&t.sendOutcome?(u.runtime.subAddresses.splice(0,1),u.runtime.remainingFlattened.splice(0,1),void u.processPartial()):(s.writeLog("PROI_008","failed subClient send to address",{transaction:t.transaction,error:t.error}),void u.partialFailed())},e.exports=u},function(e,t,n){"use strict";var r=n(8),i=n(11),s=n(14),a=n(18),o=r.get("GLOBAL"),u=!1;"INCOMING"===o.serverType&&(u=r.get("INCOMING")),"OUTGOING"===o.serverType&&(u=r.get("OUTGOING"));var c={};c.send=function(e,t){var n=["client","address","amount","transaction"];if(i.intersection(Object.keys(e),n).length!==n.length)return s.writeLog("STA_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to SelectOutgoing.run"});if(o.preventSend)return s.writeLog("STA_TEST_001","preventSend triggered",{options:e}),void t(!0,{sendOutcome:"dummy-tx-id",transaction:e.transaction});if(c.runtime={},e.counter&&e.counter>7)return s.writeLog("STA_002","max send attempts reached",{transaction:e.transaction,counter:e.counter}),void t(!1,{transaction:e.transaction,error:"max send attempts reached"});var r=1e8,d=Math.round(e.amount*r),l=d/r;e.client.sendToAddress(e.address,l,null,null,e.encrypted).then(function(n){if(n)return void t(!0,{sendOutcome:n,transaction:e.transaction})}).catch(function(n){if(n.code===-13&&!e.triedToUnlock){c.runtime.options=e,c.runtime.callback=t;var r=e.client.port===u.navCoin.port?"navCoin":"subChain";return void a.unlockWallet({settings:u,client:e.client,type:r},c.walletUnlocked)}s.writeLog("STA_003","failed send to address",{transaction:e.transaction,error:n}),setTimeout(function(){var n=e.counter?e.counter+1:1,r={client:e.client,address:e.address,amount:e.amount,transaction:e.transaction,encrypted:e.encrypted,counter:n,triedToUnlock:!1};c.send(r,t)},3e4)})},c.walletUnlocked=function(e,t){if(!e)return s.writeLog("STA_004","unable to unlock wallet",{success:e,data:t}),void c.runtime.callback(!1,{transaction:c.runtime.options.transaction,error:t});var n={client:c.runtime.options.client,address:c.runtime.options.address,amount:c.runtime.options.amount,transaction:c.runtime.options.transaction,encrypted:c.runtime.options.encrypted,counter:c.runtime.options.counter,triedToUnlock:!0};c.send(n,c.runtime.callback)},e.exports=c},function(e,t,n){"use strict";var r=n(11),i=n(14),s=n(22),a=n(16),o=n(21),u={};u.run=function(e,t){var n=["successfulSubTransactions","holdingEncrypted","navClient"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("STH_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to SpendToHolding.run"})):(u.runtime={callback:t,successfulSubTransactions:e.successfulSubTransactions,holdingEncrypted:e.holdingEncrypted,navClient:e.navClient},void s.getRandomAccountAddresses({client:u.runtime.navClient,accountName:a.account.HOLDING,numAddresses:1},u.createHoldingTransactions))},u.createHoldingTransactions=function(e,t){if(!e)return i.writeLog("STH_002","could not retrieve holding addresses",{success:e,data:t}),void u.runtime.callback(!1,{message:"could not retrieve holding addresses"});var n=1e8,r=0,s=!0,c=!1,d=void 0;try{for(var l,g=u.runtime.successfulSubTransactions[Symbol.iterator]();!(s=(l=g.next()).done);s=!0){var p=l.value;r+=Math.round(p.amount*n)-Math.round(a.txFee*n)}}catch(e){c=!0,d=e}finally{try{!s&&g.return&&g.return()}finally{if(c)throw d}}for(var m=r/n,v=[],f=0;f<u.runtime.successfulSubTransactions.length;f++)v.push({txid:u.runtime.successfulSubTransactions[f].txid,vout:parseInt(u.runtime.successfulSubTransactions[f].vout,10)});var h={};h[t.pickedAddresses[0]]=m,o.createRaw({outgoingTransactions:h,spentTransactions:v,client:u.runtime.navClient,encrypted:u.runtime.holdingEncrypted},u.sentToHolding)},u.sentToHolding=function(e,t){return e?void u.runtime.callback(!0,t):(i.writeLog("STH_003","could not send raw transaction to holding",{success:e,data:t}),void u.runtime.callback(!1,{message:"could not send raw transaction to holding"}))},e.exports=u},function(e,t,n){"use strict";var r=n(1),i=n(14),s=n(12),a=n(17),o=n(35),u=n(36),c=n(37),d=n(38),l=n(8),g=l.get("OUTGOING"),p={processing:!1,paused:!1,runtime:{}};p.init=function(){p.navClient=new r({username:g.navCoin.user,password:g.navCoin.pass,port:g.navCoin.port,host:g.navCoin.host}),p.subClient=new r({username:g.subChain.user,password:g.subChain.pass,port:g.subChain.port,host:g.subChain.host}),i.writeLog("OUT_000","server starting"),s.findKeysToRemove({type:"private"},p.startProcessing),p.cron=setInterval(function(){p.paused===!1?s.findKeysToRemove({type:"private"},p.startProcessing):i.writeLog("OUT_001","processing paused",{paused:p.paused})},g.scriptInterval)},p.startProcessing=function(){return p.processing?void i.writeLog("OUT_002","server still processing",{processing:p.processing}):(p.processing=!0,p.runtime={},p.runtime.cycleStart=new Date,void a.run({navClient:p.navClient,subClient:p.subClient,settings:g},p.preFlightComplete))},p.preFlightComplete=function(e,t){return e?(p.runtime.navBalance=t.navBalance,p.runtime.subBalance=t.subBalance,void c.run({navClient:p.navClient,settings:g},p.feePaid)):(i.writeLog("OUT_003","preflight checks failed",{success:e,data:t},!0),void(p.processing=!1))},p.feePaid=function(e,t){e||i.writeLog("OUT_006","failed nav send to txfee address",{data:t,success:e}),p.navClient.getBalance().then(function(e){p.runtime.navBalance=e,o.run({navClient:p.navClient,subClient:p.subClient,navBalance:e,settings:g},p.currentBatchPrepared)}).catch(function(e){i.writeLog("OUT_006A","failed nav send to getbalance after sending tx-fee",{data:t,err:e}),p.processing=!1})},p.currentBatchPrepared=function(e,t){return e&&t&&t.currentBatch&&0!==t.currentBatch.length?(p.runtime.failedSubTransactions=t.failedSubTransactions,p.runtime.currentBatch=t.currentBatch,void u.run({currentBatch:p.runtime.currentBatch,navClient:p.navClient,settings:g},p.transactionsProcessed)):(t.failedSubTransactions&&t.failedSubTransactions.length>0&&i.writeLog("OUT_003A","failed to prepare some subtransactions",{success:e,data:t},!0),void(p.processing=!1))},p.transactionsProcessed=function(e,t){return e&&t?!t.successfulTransactions||t.successfulTransactions.length<1?(i.writeLog("OUT_005","all transactions failed",t,!0),p.processing=!1,void(p.paused=!0)):(t.failedTransactions&&t.failedTransactions.length>0&&i.writeLog("OUT_005A","failed to send send some transactions",{success:e,data:t},!0),p.runtime.successfulTransactions=t.successfulTransactions,void d.run({transactions:p.runtime.successfulTransactions,subClient:p.subClient,settings:g},p.subnavReturned)):(i.writeLog("OUT_004","failed to process transactions",{success:e,data:t},!0),p.processing=!1,void(p.paused=!0))},p.subnavReturned=function(e,t){return e?void(p.processing=!1):(i.writeLog("OUT_007","unable to return subnav to incoming server",{transactions:p.runtime.successfulTransactions,data:t},!0),p.paused=!0,void(p.processing=!1))},e.exports=p},function(e,t,n){"use strict";var r=n(11),i=n(8),s=i.get("GLOBAL"),a=n(14),o=n(18),u=n(20),c=n(16),d={};d.run=function(e,t){var n=["navClient","subClient","navBalance","settings"];return r.intersection(Object.keys(e),n).length!==n.length?(a.writeLog("PREPO_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to ReturnAllToSenders.run"})):(d.runtime={callback:t,navClient:e.navClient,subClient:e.subClient,navBalance:e.navBalance,settings:e.settings,failedSubTransactions:[],currentBatch:[],sumPending:0},void d.runtime.navClient.getBlockCount().then(function(e){d.runtime.currentBlockHeight=e,d.getUnspent()}).catch(function(e){a.writeLog("PREPO_001A","failed to get the current blockheight",{error:e}),t(!1,{message:"failed to get the current blockheight"})}))},d.getUnspent=function(){d.runtime.subClient.listUnspent().then(function(e){return e.length<1?void d.runtime.callback(!1,{message:"no unspent transactions found"}):void o.filterUnspent({unspent:e,client:d.runtime.subClient,accountName:c.account[s.serverType]},d.unspentFiltered)}).catch(function(e){a.writeLog("PREPO_002","failed to list unspent",e),d.runtime.callback(!1,{message:"failed to list unspent"})})},d.unspentFiltered=function(e,t){return!e||!t||!t.currentPending||t.currentPending.length<1?(a.writeLog("PREPO_003","no current pending to return",t),void d.runtime.callback(!1,{message:"no current pending to return"})):(d.runtime.currentPending=t.currentPending,void d.processTransaction())},d.processTransaction=function(){return d.runtime.currentPending.length<1?void d.runtime.callback(!0,{failedSubTransactions:d.runtime.failedSubTransactions,currentBatch:d.runtime.currentBatch}):void u.getEncrypted({transaction:d.runtime.currentPending[0],client:d.runtime.subClient},d.checkDecrypted)},d.failedTransaction=function(){d.runtime.failedSubTransactions.push(d.runtime.currentPending[0]),d.runtime.currentPending.splice(0,1),d.processTransaction()},d.checkDecrypted=function(e,t){if(!(e&&t&&t.decrypted&&t.transaction))return a.writeLog("PREPO_004","failed to decrypt transaction",{success:e}),void d.failedTransaction();if(!t.decrypted.n||!t.decrypted.v||!t.decrypted.s)return a.writeLog("PREPO_005","transaction has invalid params",{success:e}),void d.failedTransaction();if(parseFloat(t.decrypted.v)>d.runtime.settings.maxAmount)return a.writeLog("PREPO_006","decrypted amount is larger than maxAmount",{success:e}),void d.failedTransaction();t.decrypted.s!==d.runtime.settings.secret&&(a.writeLog("PREPO_007","secret mismatch",{success:e}),d.failedTransaction());var n=t.decrypted;n.t||(n.t=0),d.testDecrypted(n,t.transaction)},d.testDecrypted=function(e,t){d.runtime.navClient.validateAddress(e.n).then(function(n){return n.isvalid!==!0?(a.writeLog("PREPO_008","recipient address is invalid",{transaction:t}),void d.failedTransaction()):e.t>d.runtime.currentBlockHeight?(d.runtime.currentPending.splice(0,1),void d.processTransaction()):d.runtime.navBalance>d.runtime.sumPending+parseFloat(e.v)?(d.runtime.sumPending=d.runtime.sumPending+parseFloat(e.v),d.runtime.currentBatch.push({decrypted:e,transaction:t}),d.runtime.currentPending.splice(0,1),void d.processTransaction()):void d.runtime.callback(!0,{failedSubTransactions:d.runtime.failedSubTransactions,currentBatch:d.runtime.currentBatch})}).catch(function(n){a.writeLog("PREPO_009","navClient failed validate address",{decrypted:e,transaction:t,error:n}),d.failedTransaction()})},e.exports=d},function(e,t,n){"use strict";var r=n(11),i=n(14),s=n(32),a={};a.run=function(e,t){var n=["currentBatch","settings","navClient"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("PROO_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to ProcessOutgoing.run"})):(a.runtime={callback:t,currentBatch:e.currentBatch,settings:e.settings,navClient:e.navClient,successfulTransactions:[],failedTransactions:[]},a.runtime.remainingTransactions=e.currentBatch,void a.processPending())},a.processPending=function(){return a.runtime.remainingTransactions.length<1?void a.runtime.callback(!0,{successfulTransactions:a.runtime.successfulTransactions,failedTransactions:a.runtime.failedTransactions}):void s.send({client:a.runtime.navClient,address:a.runtime.remainingTransactions[0].decrypted.n,amount:a.runtime.remainingTransactions[0].decrypted.v,transaction:a.runtime.remainingTransactions[0]},a.sentNav)},a.transactionFailed=function(){a.runtime.failedTransactions.push(a.runtime.remainingTransactions[0]),a.runtime.remainingTransactions.splice(0,1),a.processPending()},a.mockSend=function(){i.writeLog("PROO_003A","mock nav sent",{transaction:a.runtime.remainingTransactions[0]}),a.runtime.successfulTransactions.push({transaction:a.runtime.remainingTransactions[0].transaction}),a.runtime.remainingTransactions.splice(0,1),a.processPending()},a.sentNav=function(e,t){e&&t&&t.sendOutcome?a.runtime.successfulTransactions.push(a.runtime.remainingTransactions[0]):(i.writeLog("PROO_004","failed nav send to address",t,!0),a.runtime.failedTransactions.push(a.runtime.remainingTransactions[0])),a.runtime.remainingTransactions.splice(0,1),a.processPending()},e.exports=a},function(e,t,n){"use strict";var r=n(11),i=n(14),s=n(32),a=n(16),o={};o.run=function(e,t){var n=["settings","navClient"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("PAY_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to PayoutFee.run"})):(o.runtime={callback:t,settings:e.settings,navClient:e.navClient},void o.send())},o.send=function(){o.runtime.navClient.listUnspent(20).then(function(e){var t=0,n=1e8,r=!0,u=!1,c=void 0;try{for(var d,l=e[Symbol.iterator]();!(r=(d=l.next()).done);r=!0){var g=d.value;t+=Math.round(g.amount*n)}}catch(e){u=!0,c=e}finally{try{!r&&l.return&&l.return()}finally{if(u)throw c}}var p=t/n;if(p<o.runtime.settings.navPoolAmount)return i.writeLog("PAY_002","nav pool balance less than expected",{navPoolAmount:o.runtime.settings.navPoolAmount,navBalance:p}),void o.runtime.callback(!1,{message:"nav pool balance less than expected"});var m=p-o.runtime.settings.navPoolAmount-a.txFee;return m<o.runtime.settings.txFeePayoutMin?void o.runtime.callback(!1,{message:"fee accrued less than payout minimum"}):void s.send({client:o.runtime.navClient,address:o.runtime.settings.anonTxFeeAddress,amount:m,transaction:{txid:"TX_FEE_PAYOUT"}},o.sent)}).catch(function(e){i.writeLog("PAY_002A","error getting balance",{error:e}),o.runtime.callback(!1,{message:"error getting balance"})})},o.sent=function(e,t){return e?void o.runtime.callback(!0,t):void o.runtime.callback(!1,{message:"failed to send fee payout"})},e.exports=o},function(e,t,n){"use strict";var r=n(11),i=n(14),s=n(26),a={};a.run=function(e,t){var n=["settings","subClient","transactions"];return r.intersection(Object.keys(e),n).length!==n.length?(i.writeLog("RSN_001","invalid options",{options:e,required:n}),void t(!1,{message:"invalid options provided to ReturnSubnav.run"})):(a.runtime={callback:t,settings:e.settings,subClient:e.subClient,transactions:e.transactions},a.runtime.remainingTransactions=e.transactions,void a.sendToIncoming())},a.sendToIncoming=function(){return a.runtime.remainingTransactions.constructor!==Array||a.runtime.remainingTransactions.length<1?void a.runtime.callback(!0,{message:"all subnav returned to incoming server"}):void s.send({client:a.runtime.subClient,transaction:a.runtime.remainingTransactions[0].transaction},a.sent)},a.sent=function(e,t){return e&&t&&t.rawOutcome?(a.runtime.remainingTransactions.splice(0,1),void a.sendToIncoming()):(i.writeLog("RSN_002","unable to return subnav to incoming server",{remaining:a.runtime.remainingTransactions,success:e,data:t},!0),void a.runtime.callback(!1,{message:"failed to return subnav"}))},e.exports=a},function(e,t,n){"use strict";function r(e,t,n,s){if("object"===("undefined"==typeof e?"undefined":m(e))&&"remote"!==s)for(var a in n)n.hasOwnProperty(a)&&r(e[a],t,n[a],a);else if("remote"===s)for(var o=0;o<e.length;o++)for(var u in n)n.hasOwnProperty(u)&&r(e[o][u],t,n[u],u);else i(e,t,n,s)}function i(e,t,n,r){if(n.required===!0&&!e)return void C.errors.push("VALUE_IS_REQUIRED for "+r,e);if(n.required!==!1||e&&void 0!==e){if("object"===m(n.required)&&n.required.conditional){var i=n.required.conditional.split(".");if("GLOBAL"===i[0]){var v=y[i[1]];if(!v)return}}if(!e||void 0===e)return void C.errors.push("MISSING_VALUE for "+r+", must provide a valid value");if(!t||t.indexOf(r)===-1)switch(n.type){case"DOMAIN":s(e,n,r);break;case"IP_ADDRESS":a(e,n,r);break;case"PORT":o(e,n,r);break;case"INT":u(e,n,r);break;case"FLOAT":c(e,n,r);break;case"EMAIL":d(e,n,r);break;case"NAV_ADDRESS":l(e,n,r);break;case"STRING":g(e,n,r);break;case"VALUE":p(e,n,r);break;default:C.errors.push("NO_VALIDATION_SET for "+r)}}}function s(e,t,n){return!!f.isFQDN(e)||(C.errors.push("INVALID_DOMAIN for "+n+", must be a valid fully qualified domain name"),!1)}function a(e,t,n){return!!f.isIP(e)||(C.errors.push("INVALID_IP_ADDRESS for "+n+", must be a valid IP Address"),!0)}function o(e,t,n){var r=parseInt(e,10);return(r<1||r>65535)&&(C.errors.push("PORT_OUT_OF_RANGE for "+n+", must be between 1 and 65535 "),!0)}function u(e,t,n){var r=parseInt(e,10);return t.min&&r<t.min?(C.errors.push("INT_TOO_SMALL for "+n+", must be bigger than "+t.min),!1):!(t.max&&r>t.max)||(C.errors.push("INT_TOO_LARGE for "+n+", must be smaller than "+t.max),!1)}function c(e,t,n){var r=parseFloat(e);if(t.min&&r<t.min)return C.errors.push("FLOAT_TOO_SMALL for "+n+", must be bigger than "+t.min),!1;if(t.max&&r>t.max)return C.errors.push("FLOAT_TOO_LARGE for "+n+", must be smaller than "+t.max),!1;if(t.decimals&&2===t.decimals){var i=e.toString().search(A)>=0;if(!i)return C.errors.push("FLOAT_INCORRECT_FORMAT for "+n+", must have a maximum of 2 decimal places "),!1}return!0}function d(e,t,n){return!!f.isEmail(e)||(C.errors.push("INVALID_DOMAIN for "+n+", must be a valid fully qualified domain name"),!1)}function l(e,t,n){return 34===e.length||"N"===e.charAt(0)||(C.errors.push("INVALID_NAV_ADDRESSS for "+n+", must be 34 characters and starting with N"),!1)}function g(e,t,n){return!t.length||e.length===t.length||(C.errors.push("INCORRECT_LENGTH for "+n+", must be "+t.length+" characters"+e.length+" provided"),!1)}function p(e,t,n){return e===t.value||(C.errors.push("INCORRECT_VALUE for "+n+", must equal "+t.value),!1)}var m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v=n(8),f=n(40),h=n(14),y=v.get("GLOBAL"),b=n(41),T=n(42),A=/^(\d+)?([.]?\d{0,2})?$/,C={errors:[]};C.validateSettings=function(e,t){if(C.errors=[],"INCOMING"===y.serverType)r(e.settings,e.ignore,b);else{if("OUTGOING"!==y.serverType)return h.writeLog("VAL_001","invalid server type",{options:e}),void t(!1);r(e.settings,e.ignore,T)}C.errors.length<1?t(!0):(h.writeLog("VAL_002","invalid settings",{errors:C.errors}),t(!1))},e.exports=C},function(e,t){e.exports=require("validator")},function(e,t){e.exports={local:{ipAddress:{required:!0,type:"IP_ADDRESS"},port:{required:!0,type:"PORT"}},remote:{host:{required:!1,type:"DOMAIN"},ipAddress:{required:!0,type:"IP_ADDRESS"},port:{required:!0,type:"PORT"}},scriptInterval:{required:!0,type:"INT",min:3e4},minAmount:{required:!0,type:"INT",min:1},maxAmount:{required:!0,type:"INT",min:10},anonFeePercent:{required:!0,type:"FLOAT",min:0,max:99,decimals:2},notificationEmail:{required:!0,type:"EMAIL"},smtp:{user:{required:!0,type:"EMAIL"},pass:{required:!0,type:"STRING"},server:{required:!0,type:"DOMAIN"}},navCoin:{user:{required:!0,type:"STRING"},pass:{required:!0,type:"STRING"},ip:{required:!0,type:"IP_ADDRESS"},port:{required:!0,type:"VALUE",value:"44444"},walletPassphrase:{required:{conditional:"GLOBAL.encryptedWallet"},type:"STRING"}},subChain:{user:{required:!0,type:"STRING"},pass:{required:!0,type:"STRING"},ip:{required:!0,type:"IP_ADDRESS"},port:{required:!0,type:"VALUE",value:"33333"},walletPassphrase:{required:{conditional:"GLOBAL.encryptedWallet"},type:"STRING"}},secretOptions:{salt:{required:!0,type:"STRING",length:32},saltRounds:{required:!0,type:"INT",min:1,max:20}},secret:{required:!0,type:"STRING",length:32}}},function(e,t){e.exports={local:{ipAddress:{required:!0,type:"IP_ADDRESS"},port:{required:!0,type:"PORT"}},remote:{host:{required:!1,type:"DOMAIN"},ipAddress:{required:!0,type:"IP_ADDRESS"},port:{required:!0,type:"PORT"}},scriptInterval:{required:!0,type:"INT",min:12e4},minAmount:{required:!0,type:"INT",min:1},maxAmount:{required:!0,type:"INT",min:10},navPoolAmount:{required:!0,type:"INT",min:5e4},txFeePayoutMin:{required:!0,type:"INT",min:1},anonTxFeeAddress:{required:!0,type:"NAV_ADDRESS"},notificationEmail:{required:!0,type:"EMAIL"},smtp:{user:{required:!0,type:"EMAIL"},pass:{required:!0,type:"STRING"},server:{required:!0,type:"DOMAIN"}},navCoin:{user:{required:!0,type:"STRING"},pass:{required:!0,type:"STRING"},ip:{required:!0,type:"IP_ADDRESS"},port:{required:!0,type:"VALUE",value:"44444"},walletPassphrase:{required:{conditional:"GLOBAL.encryptedWallet"},type:"STRING"}},subChain:{user:{required:!0,type:"STRING"},pass:{required:!0,type:"STRING"},ip:{required:!0,type:"IP_ADDRESS"},port:{required:!0,type:"VALUE",value:"33333"},walletPassphrase:{required:{conditional:"GLOBAL.encryptedWallet"},type:"STRING"}},secret:{required:!0,type:"STRING",length:32}}}]);